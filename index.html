<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>g1 Brookasil - O portal de not√≠cias de Brookasil</title>
    <style>
        /* --- RESET E VARI√ÅVEIS --- */
        :root {
            --cor-primaria: #004990; /* Azul Forte */
            --cor-secundaria: #009c3b; /* Verde Bandeira */
            --cor-fundo: #f7f7f7;
            --cor-texto: #333;
            --cor-destaque: #c4170c; /* Vermelho para 'Ao Vivo' ou erros */
            --borda: 1px solid #ddd;
            --sombra: 0 2px 5px rgba(0,0,0,0.05);
            --font-main: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-main); background-color: var(--cor-fundo); color: var(--cor-texto); line-height: 1.6; padding-bottom: 50px; }
        a { text-decoration: none; color: inherit; transition: 0.3s; }
        ul { list-style: none; }
        img { max-width: 100%; display: block; object-fit: cover; }
        button, input, select, textarea { font-family: inherit; }

        /* --- LAYOUT UTILS --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 15px; }
        .hidden { display: none !important; }
        .flex { display: flex; }
        .grid { display: grid; }
        .btn { padding: 10px 20px; border: none; cursor: pointer; border-radius: 4px; font-weight: bold; font-size: 14px; }
        .btn-primary { background: var(--cor-primaria); color: #fff; }
        .btn-secondary { background: var(--cor-secundaria); color: #fff; }
        .btn-danger { background: var(--cor-destaque); color: #fff; }
        .btn:hover { opacity: 0.9; }

        /* --- HEADER --- */
        header { background: #fff; border-bottom: 1px solid #ddd; position: relative; z-index: 100; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; }
        
        .logo { font-size: 2.5rem; font-weight: 800; letter-spacing: -1px; color: var(--cor-primaria); }
        .logo span { color: var(--cor-secundaria); }

        .search-box { flex: 1; max-width: 500px; margin: 0 20px; position: relative; }
        .search-box input { width: 100%; padding: 10px 15px; border: 1px solid #ccc; border-radius: 4px; background: #f0f0f0; }
        
        .weather-widget { font-size: 0.85rem; text-align: right; color: #666; display: flex; flex-direction: column; justify-content: center; }
        .weather-temp { font-weight: bold; font-size: 1.2rem; color: var(--cor-primaria); }

        /* --- MENU --- */
        .main-menu { background: var(--cor-primaria); position: sticky; top: 0; z-index: 99; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .main-menu ul { display: flex; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; }
        .main-menu a { display: block; padding: 12px 18px; color: #fff; font-weight: 600; font-size: 0.95rem; }
        .main-menu a:hover, .main-menu a.active { background: var(--cor-secundaria); }
        
        /* Mobile Menu Button */
        .menu-toggle { display: none; color: white; font-size: 24px; cursor: pointer; padding: 10px; }

        /* --- CONTE√öDO PRINCIPAL --- */
        main { margin-top: 20px; min-height: 80vh; }
        
        .section-title { font-size: 1.2rem; color: var(--cor-secundaria); border-bottom: 2px solid var(--cor-secundaria); padding-bottom: 5px; margin-bottom: 20px; font-weight: bold; text-transform: uppercase; }

        /* Grid de Not√≠cias */
        .news-grid { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        
        /* Card Not√≠cia */
        .news-card { background: #fff; border-radius: 8px; overflow: hidden; box-shadow: var(--sombra); transition: transform 0.2s; cursor: pointer; display: flex; flex-direction: column; }
        .news-card:hover { transform: translateY(-3px); }
        .news-card img { width: 100%; height: 200px; }
        .news-content { padding: 15px; flex: 1; display: flex; flex-direction: column; }
        .news-theme { color: var(--cor-secundaria); font-weight: bold; font-size: 0.8rem; text-transform: uppercase; margin-bottom: 5px; }
        .news-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; line-height: 1.3; color: var(--cor-primaria); }
        .news-meta { margin-top: auto; font-size: 0.8rem; color: #777; display: flex; justify-content: space-between; }

        /* Destaque Principal */
        .hero-news { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 40px; background: #fff; padding: 20px; border-radius: 8px; box-shadow: var(--sombra); }
        .hero-main { position: relative; cursor: pointer; }
        .hero-main img { width: 100%; height: 400px; border-radius: 8px; filter: brightness(0.8); }
        .hero-overlay { position: absolute; bottom: 0; left: 0; right: 0; padding: 30px; background: linear-gradient(transparent, rgba(0,0,0,0.9)); color: #fff; border-radius: 0 0 8px 8px; }
        .hero-title { font-size: 2.5rem; font-weight: 800; line-height: 1.1; margin-bottom: 10px; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
        
        .hero-side { display: flex; flex-direction: column; gap: 15px; }
        .mini-card { display: flex; gap: 10px; cursor: pointer; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .mini-card img { width: 80px; height: 80px; border-radius: 4px; }
        .mini-card h4 { font-size: 1rem; color: #333; line-height: 1.2; }

        /* --- P√ÅGINA NOT√çCIA --- */
        .news-detail { background: #fff; padding: 40px; border-radius: 8px; box-shadow: var(--sombra); max-width: 900px; margin: 0 auto; }
        .news-header h1 { font-size: 2.5rem; color: var(--cor-primaria); line-height: 1.2; margin-bottom: 10px; }
        .news-header .subtitle { font-size: 1.3rem; color: #555; margin-bottom: 20px; font-weight: 300; }
        .news-info { border-top: 1px solid #eee; border-bottom: 1px solid #eee; padding: 10px 0; margin-bottom: 20px; font-size: 0.9rem; color: #666; }
        .news-body { font-size: 1.1rem; line-height: 1.8; color: #222; }
        .news-body p { margin-bottom: 20px; }
        .news-body img { margin: 20px 0; border-radius: 4px; width: 100%; max-height: 500px; object-fit: contain; background: #eee; }

        /* --- PAIN√âIS E FORMUL√ÅRIOS --- */
        .auth-box, .panel-box { background: #fff; padding: 30px; max-width: 600px; margin: 40px auto; border-radius: 8px; box-shadow: var(--sombra); }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .form-group textarea { height: 100px; }
        
        /* Perfil */
        .profile-header { text-align: center; margin-bottom: 30px; }
        .profile-img { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid var(--cor-primaria); margin: 0 auto 15px; background: #ddd; }
        .role-badge { display: inline-block; padding: 4px 10px; background: #eee; border-radius: 20px; font-size: 0.8rem; font-weight: bold; margin-top: 5px; text-transform: uppercase; }

        /* --- FOOTER --- */
        footer { background: var(--cor-primaria); color: #fff; padding: 40px 0; margin-top: 50px; }
        .footer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; }
        .footer-col h3 { margin-bottom: 15px; border-bottom: 2px solid var(--cor-secundaria); display: inline-block; padding-bottom: 5px; }
        .footer-col ul li { margin-bottom: 8px; }
        .footer-col a:hover { text-decoration: underline; color: #ddd; }
        .copy { text-align: center; margin-top: 40px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; font-size: 0.85rem; }

        /* --- RESPONSIVIDADE --- */
        @media (max-width: 768px) {
            .hero-news { grid-template-columns: 1fr; }
            .top-bar { flex-direction: column; gap: 15px; text-align: center; }
            .logo { font-size: 2rem; }
            .search-box { width: 100%; margin: 0; }
            .main-menu ul { display: none; flex-direction: column; }
            .main-menu.open ul { display: flex; }
            .menu-toggle { display: block; }
            .weather-widget { text-align: center; }
            .news-detail { padding: 20px; }
        }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <div class="top-bar">
                <div class="logo">g1 <span>Brookasil</span></div>
                
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Buscar por t√≠tulo, tema ou jornalista...">
                </div>

                <div class="weather-widget" id="weatherWidget">
                    <div>Carregando clima...</div>
                    </div>
            </div>
        </div>
    </header>

    <nav class="main-menu">
        <div class="container">
            <div class="menu-toggle" onclick="toggleMenu()">‚ò∞ Menu</div>
            <ul id="navLinks">
                <li><a href="#" onclick="router.go('home')" class="active">Home</a></li>
                <li><a href="#" onclick="router.go('politica')">Pol√≠tica</a></li>
                <li><a href="#" onclick="router.go('policia')">Pol√≠cia</a></li>
                <li><a href="#" onclick="router.go('educacao')">Educa√ß√£o</a></li>
                <li><a href="#" onclick="router.go('esporte')">Esporte</a></li>
                <li><a href="#" onclick="router.go('filiacao')">Filia√ß√£o Partid√°ria</a></li>
                <li><a href="#" onclick="router.go('candidatura')">Candidatura (CDE)</a></li>
                <li><a href="#" onclick="router.go('divulgacao')">Divulga√ß√£o</a></li>
                <li><a href="#" onclick="router.go('perfil')" id="profileLink">Minha Conta</a></li>
            </ul>
        </div>
    </nav>

    <main id="app" class="container">
        </main>

    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h3>g1 Brookasil</h3>
                    <ul>
                        <li><a href="#" onclick="router.go('home')">√öltimas Not√≠cias</a></li>
                        <li><a href="#" onclick="router.go('politica')">Pol√≠tica e Elei√ß√µes</a></li>
                        <li><a href="#">Princ√≠pios Editoriais</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>Institucional</h3>
                    <ul>
                        <li><a href="#" onclick="router.go('filiacao')">Seja um Filiado</a></li>
                        <li><a href="#" onclick="router.go('candidatura')">Candidaturas CDE</a></li>
                        <li><a href="#" onclick="router.go('divulgacao')">Anuncie Conosco</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>Redes Sociais</h3>
                    <ul>
                        <li><a href="#">Twitter/X</a></li>
                        <li><a href="#">Instagram</a></li>
                        <li><a href="#">Facebook</a></li>
                    </ul>
                </div>
            </div>
            <div class="copy">
                &copy; 2025 g1 Brookasil. Todos os direitos reservados. Projeto Front-end sem fins lucrativos.
            </div>
        </div>
    </footer>

    <script>
        /**
         * CONFIGURA√á√ÉO E DADOS
         */
        const DB_URL = "https://g1-brookasil-default-rtdb.firebaseio.com";
        
        // Dados padr√£o para inicializa√ß√£o (Caso o banco esteja vazio)
        const SEED_NEWS = [
            {
                id: 'n1',
                title: 'Prefeito anuncia novas obras no centro de Brookasil',
                subtitle: 'Projeto visa revitalizar a pra√ßa central e melhorar o tr√¢nsito na regi√£o.',
                theme: 'pol√≠tica',
                image: 'https://images.unsplash.com/photo-1541888946425-d81bb19240f5?auto=format&fit=crop&w=800&q=80',
                content: 'A prefeitura de Brookasil anunciou nesta manh√£ um pacote de obras ambicioso...',
                author: 'Reda√ß√£o',
                date: new Date().toISOString(),
                views: 120
            },
            {
                id: 'n2',
                title: 'Campeonato local de futebol come√ßa neste fim de semana',
                subtitle: 'Times j√° est√£o escalados para a grande abertura no est√°dio municipal.',
                theme: 'esporte',
                image: 'https://images.unsplash.com/photo-1522778119026-d647f0565c6a?auto=format&fit=crop&w=800&q=80',
                content: 'Os torcedores j√° podem preparar suas bandeiras. O campeonato come√ßa com tudo...',
                author: 'Jo√£o Esporte',
                date: new Date().toISOString(),
                views: 340
            }
        ];

        // Estado da Aplica√ß√£o
        const state = {
            currentUser: JSON.parse(localStorage.getItem('g1_user')) || null,
            news: [],
            users: {},
            ads: [], // Pedidos de divulga√ß√£o
            currentView: 'home'
        };

        /**
         * GERENCIADOR DE DADOS (DATABASE)
         */
        const DataManager = {
            async init() {
                await this.fetchNews();
                await this.fetchUsers();
                await this.fetchAds();
            },

            async fetchNews() {
                try {
                    const res = await fetch(`${DB_URL}/news.json`);
                    const data = await res.json();
                    if (data) {
                        state.news = Object.values(data);
                    } else {
                        state.news = SEED_NEWS; // Fallback seed
                        // Opcional: Salvar o seed no banco na primeira vez
                        this.saveNews(SEED_NEWS[0]); 
                        this.saveNews(SEED_NEWS[1]);
                    }
                } catch (e) {
                    console.error("Erro ao buscar not√≠cias:", e);
                    state.news = SEED_NEWS; // Modo Offline/Erro
                }
            },

            async saveNews(newsItem) {
                if (!newsItem.id) newsItem.id = 'n' + Date.now();
                
                // Atualiza local state
                const idx = state.news.findIndex(n => n.id === newsItem.id);
                if (idx >= 0) state.news[idx] = newsItem;
                else state.news.push(newsItem);

                // Salva no Firebase
                try {
                    await fetch(`${DB_URL}/news/${newsItem.id}.json`, {
                        method: 'PUT',
                        body: JSON.stringify(newsItem)
                    });
                } catch (e) { console.error("Erro ao salvar:", e); }
            },

            async deleteNews(id) {
                // Front-end
                state.news = state.news.filter(n => n.id !== id);
                // Backend
                try {
                    await fetch(`${DB_URL}/news/${id}.json`, { method: 'DELETE' });
                } catch(e) { console.error(e); }
                router.go('home');
            },

            async fetchUsers() {
                try {
                    const res = await fetch(`${DB_URL}/users.json`);
                    state.users = await res.json() || {};
                } catch (e) { console.error(e); }
            },

            async registerUser(user) {
                // Simula√ß√£o simples de ID baseada no email (sanitizado)
                const userId = user.email.replace(/[.]/g, '_');
                user.id = userId;
                
                if (state.users[userId]) return false; // J√° existe

                state.users[userId] = user;
                
                try {
                    await fetch(`${DB_URL}/users/${userId}.json`, {
                        method: 'PUT',
                        body: JSON.stringify(user)
                    });
                } catch(e) { console.error(e); }
                return true;
            },

            async updateUser(user) {
                state.users[user.id] = user;
                // Atualiza sess√£o atual se for o pr√≥prio
                if(state.currentUser && state.currentUser.id === user.id) {
                    state.currentUser = user;
                    localStorage.setItem('g1_user', JSON.stringify(user));
                }
                
                try {
                    await fetch(`${DB_URL}/users/${user.id}.json`, {
                        method: 'PUT',
                        body: JSON.stringify(user)
                    });
                } catch(e) { console.error(e); }
            },

            async fetchAds() {
                try {
                    const res = await fetch(`${DB_URL}/ads.json`);
                    const data = await res.json();
                    state.ads = data ? Object.values(data) : [];
                } catch(e) {}
            },

            async createAd(ad) {
                ad.id = 'ad' + Date.now();
                ad.status = 'pendente';
                state.ads.push(ad);
                try {
                    await fetch(`${DB_URL}/ads/${ad.id}.json`, {
                        method: 'PUT',
                        body: JSON.stringify(ad)
                    });
                } catch(e) {}
            },

            async updateAdStatus(id, status) {
                const ad = state.ads.find(a => a.id === id);
                if(ad) {
                    ad.status = status;
                    await fetch(`${DB_URL}/ads/${id}.json`, {
                        method: 'PUT',
                        body: JSON.stringify(ad)
                    });
                }
            }
        };

        /**
         * CLIMA E DATA (API OpenMeteo)
         */
        const WeatherManager = {
            async init() {
                const widget = document.getElementById('weatherWidget');
                const now = new Date();
                const timeStr = now.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});
                
                // Coordenadas aproximadas para a regi√£o mencionada no prompt (Alagoas/Macei√≥)
                // Mas o label ser√° gen√©rico
                const lat = -9.66;
                const lon = -35.73;

                try {
                    const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
                    const data = await res.json();
                    const temp = Math.round(data.current_weather.temperature);
                    const code = data.current_weather.weathercode;
                    
                    let condicao = "Ensolarado";
                    if (code > 3) condicao = "Nublado";
                    if (code > 50) condicao = "Chuvoso";

                    widget.innerHTML = `
                        <div class="weather-temp">${temp}¬∞C <span style="font-size:0.8rem; font-weight:normal;">${condicao}</span></div>
                        <div>${timeStr} - Regi√£o Metropolitana</div>
                    `;
                } catch (e) {
                    widget.innerHTML = `<div>${timeStr}</div><div>28¬∞C (Est.)</div>`;
                }
            }
        };

        /**
         * ROTEAMENTO E VIEWS
         */
        const router = {
            go: (route, param = null) => {
                state.currentView = route;
                window.scrollTo(0,0);
                renderApp(param);
                
                // Atualiza links ativos
                document.querySelectorAll('.main-menu a').forEach(a => a.classList.remove('active'));
                // Tenta ativar o link correspondente
                const link = document.querySelector(`.main-menu a[onclick*="'${route}'"]`);
                if(link) link.classList.add('active');
            }
        };

        function toggleMenu() {
            document.querySelector('.main-menu').classList.toggle('open');
        }

        /**
         * RENDERIZADORES
         */
        const main = document.getElementById('app');

        function renderApp(param) {
            main.innerHTML = '';
            
            // Views Est√°ticas
            if (state.currentView === 'filiacao') return renderFiliacao();
            if (state.currentView === 'candidatura') return renderCandidatura();
            if (state.currentView === 'perfil') return renderProfile();
            if (state.currentView === 'login') return renderLogin();
            if (state.currentView === 'register') return renderRegister();
            if (state.currentView === 'editor') return renderEditor(param); // param = newsId
            if (state.currentView === 'divulgacao') return renderDivulgacao();
            if (state.currentView === 'news') return renderNewsDetail(param); // param = newsId

            // Views de Not√≠cias (Home e Categorias)
            renderNewsFeed(state.currentView, param);
        }

        function renderNewsFeed(category, searchTerm) {
            let filteredNews = state.news.sort((a,b) => new Date(b.date) - new Date(a.date));

            if (category !== 'home') {
                filteredNews = filteredNews.filter(n => 
                    n.theme.toLowerCase().includes(category.toLowerCase())
                );
            }
            
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filteredNews = filteredNews.filter(n => 
                    n.title.toLowerCase().includes(term) || 
                    n.theme.toLowerCase().includes(term) ||
                    (n.author && n.author.toLowerCase().includes(term))
                );
            }

            let html = '';

            // Hero Section apenas na Home
            if (category === 'home' && filteredNews.length > 0 && !searchTerm) {
                const destaque = filteredNews[0];
                const laterNews = filteredNews.slice(1, 4);

                html += `
                <div class="section-title">Manchete Principal</div>
                <div class="hero-news">
                    <div class="hero-main" onclick="router.go('news', '${destaque.id}')">
                        <img src="${destaque.image}" alt="${destaque.title}">
                        <div class="hero-overlay">
                            <div style="color: #ffca28; font-weight: bold; text-transform: uppercase;">${destaque.theme}</div>
                            <h2 class="hero-title">${destaque.title}</h2>
                            <p>${destaque.subtitle}</p>
                        </div>
                    </div>
                    <div class="hero-side">
                        <h3 style="color:var(--cor-destaque); text-transform:uppercase; font-size:0.9rem;">Destaques do dia</h3>
                        ${laterNews.map(n => `
                            <div class="mini-card" onclick="router.go('news', '${n.id}')">
                                <img src="${n.image}" alt="">
                                <h4>${n.title}</h4>
                            </div>
                        `).join('')}
                    </div>
                </div>
                `;
                
                // Remove os que j√° apareceram no destaque da lista principal
                filteredNews = filteredNews.slice(4);
            }

            html += `<div class="section-title">${searchTerm ? 'Resultados da Busca' : '√öltimas Not√≠cias'}</div>`;
            
            if (filteredNews.length === 0) {
                html += `<p style="text-align:center; padding: 50px; color:#777;">Nenhuma not√≠cia encontrada.</p>`;
            } else {
                html += `<div class="news-grid grid">`;
                html += filteredNews.map(n => `
                    <div class="news-card" onclick="router.go('news', '${n.id}')">
                        <img src="${n.image}" loading="lazy" alt="${n.title}">
                        <div class="news-content">
                            <div class="news-theme">${n.theme}</div>
                            <div class="news-title">${n.title}</div>
                            <div class="news-meta">
                                <span>Por ${n.author || 'Reda√ß√£o'}</span>
                                <span>${new Date(n.date).toLocaleDateString()}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
                html += `</div>`;
            }

            main.innerHTML = html;
        }

        function renderNewsDetail(id) {
            const news = state.news.find(n => n.id === id);
            if (!news) return router.go('home');

            // Contabilizar visualiza√ß√£o (simples)
            news.views = (news.views || 0) + 1;
            DataManager.saveNews(news);

            // Verificar se usu√°rio √© Dono ou o Autor para mostrar bot√£o de editar
            let editBtn = '';
            if (state.currentUser) {
                if (state.currentUser.role === 'dono' || (state.currentUser.role === 'jornalista' && state.currentUser.name === news.author)) {
                    editBtn = `<button class="btn btn-secondary" onclick="router.go('editor', '${news.id}')" style="margin-left: 10px;">‚úèÔ∏è Editar Not√≠cia</button>`;
                }
            }

            main.innerHTML = `
                <div class="news-detail">
                    <div class="news-header">
                        <h1>${news.title}</h1>
                        <div class="subtitle">${news.subtitle}</div>
                        <div class="news-info">
                            <span>Por <strong>${news.author}</strong></span> | 
                            <span>${new Date(news.date).toLocaleString()}</span> | 
                            <span>${news.theme}</span>
                            ${editBtn}
                        </div>
                    </div>
                    <div class="news-body">
                        <img src="${news.image}" alt="${news.title}">
                        <p>${news.content.replace(/\n/g, '<br><br>')}</p>
                    </div>
                    <hr>
                    <div style="margin-top:20px;">
                        <button class="btn btn-primary" onclick="window.history.back()">Voltar</button>
                    </div>
                </div>
            `;
        }

        function renderFiliacao() {
            main.innerHTML = `
                <div class="auth-box" style="text-align:center; max-width:800px;">
                    <h1 style="color:var(--cor-primaria); margin-bottom:20px;">Filia√ß√£o Partid√°ria</h1>
                    <p style="margin-bottom:20px; text-align:left;">A filia√ß√£o partid√°ria √© o ato pelo qual um eleitor aceita e adota o programa, o estatuto e as diretrizes de um partido pol√≠tico. Para se candidatar a cargos eletivos, a filia√ß√£o √© obrigat√≥ria.</p>
                    
                    <h3 style="text-align:left; margin-bottom:10px;">Quem pode se filiar?</h3>
                    <ul style="text-align:left; margin-bottom:20px; list-style: disc; padding-left:20px;">
                        <li>Cidad√£os com pleno gozo dos direitos pol√≠ticos.</li>
                        <li>N√£o filiados a outro partido (a dupla filia√ß√£o n√£o √© permitida).</li>
                    </ul>

                    <div style="background:#e8f4fd; padding:20px; border-radius:8px; margin:30px 0;">
                        <h2 style="margin-bottom:10px;">Deseja se filiar agora?</h2>
                        <a href="https://tsedoroblox2025.github.io/filia-o.html/" target="_blank" class="btn btn-secondary" style="font-size:1.2rem;">Ir para o site de Filia√ß√£o &rarr;</a>
                    </div>
                </div>
            `;
        }

        function renderCandidatura() {
            main.innerHTML = `
                <div class="auth-box" style="text-align:center; max-width:800px;">
                    <h1 style="color:var(--cor-primaria); margin-bottom:20px;">Candidatura (CDE)</h1>
                    <p style="margin-bottom:20px; text-align:left;">O sistema CDE (Cidade Eleitoral) gerencia todo o processo de candidaturas para as elei√ß√µes em Brookasil. Aqui voc√™ encontrar√° as regras, prazos e documenta√ß√£o necess√°ria.</p>
                    
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; text-align:left; margin-bottom:30px;">
                        <div>
                            <h4>1. Requisitos</h4>
                            <p>Estar filiado, ter domic√≠lio eleitoral e idade m√≠nima.</p>
                        </div>
                        <div>
                            <h4>2. Registro</h4>
                            <p>O pedido deve ser feito via sistema oficial dentro do prazo.</p>
                        </div>
                    </div>

                    <div style="background:#e0f2f1; padding:20px; border-radius:8px; margin:30px 0;">
                        <h2 style="margin-bottom:10px;">Registrar Candidatura</h2>
                        <a href="https://tsedoroblox2025.github.io/candidatura-cde/" target="_blank" class="btn btn-secondary" style="font-size:1.2rem;">Ir para o site de Candidatura &rarr;</a>
                    </div>
                </div>
            `;
        }

        /* --- SISTEMA DE CONTAS --- */

        function renderProfile() {
            if (!state.currentUser) {
                renderLogin();
                return;
            }

            const u = state.currentUser;
            const isOwner = u.role === 'dono';
            const isJournalist = u.role === 'jornalista' || isOwner;

            // Painel do Dono
            let adminSection = '';
            if (isOwner) {
                adminSection = `
                    <div class="panel-box" style="border: 2px solid var(--cor-secundaria);">
                        <h3 style="color:var(--cor-secundaria); margin-bottom:15px;">üëë Painel do Dono</h3>
                        
                        <div style="margin-bottom: 20px;">
                            <h4>Aprovar Divulga√ß√µes</h4>
                            ${state.ads.filter(a => a.status === 'pendente').length === 0 ? '<p><i>Nenhuma solicita√ß√£o pendente.</i></p>' : ''}
                            <ul style="margin-top:10px;">
                                ${state.ads.filter(a => a.status === 'pendente').map(ad => `
                                    <li style="background:#eee; padding:10px; margin-bottom:5px; border-radius:4px; display:flex; justify-content:space-between; align-items:center;">
                                        <span><strong>${ad.category}:</strong> ${ad.title}</span>
                                        <div>
                                            <button class="btn btn-secondary" style="padding:5px 10px; font-size:0.8rem;" onclick="approveAd('${ad.id}', 'aprovado')">‚úì</button>
                                            <button class="btn btn-danger" style="padding:5px 10px; font-size:0.8rem;" onclick="approveAd('${ad.id}', 'rejeitado')">‚úó</button>
                                        </div>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        
                        <div>
                            <h4>Gerenciar Usu√°rios (Promover)</h4>
                            <div class="flex" style="gap:5px;">
                                <input type="email" id="promoteEmail" placeholder="Email do usu√°rio..." style="padding:5px;">
                                <button class="btn btn-primary" onclick="promoteUser()">Promover a Jornalista</button>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Painel Jornalista
            let journalistSection = '';
            if (isJournalist) {
                journalistSection = `
                    <div class="panel-box">
                        <h3 style="margin-bottom:15px;">üì∞ Painel do Jornalista</h3>
                        <button class="btn btn-primary" onclick="router.go('editor')">+ Nova Not√≠cia</button>
                        
                        <h4 style="margin-top:20px;">Minhas Not√≠cias</h4>
                        <ul style="margin-top:10px;">
                            ${state.news.filter(n => n.author === u.name || isOwner).map(n => `
                                <li style="padding:8px 0; border-bottom:1px solid #eee; display:flex; justify-content:space-between;">
                                    <span>${n.title.substring(0,40)}... (${n.views||0} views)</span>
                                    <div>
                                        <button onclick="router.go('editor', '${n.id}')" style="cursor:pointer; border:none; background:none;">‚úèÔ∏è</button>
                                        ${isOwner ? `<button onclick="deleteNews('${n.id}')" style="cursor:pointer; border:none; background:none; color:red;">üóëÔ∏è</button>` : ''}
                                    </div>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            }

            main.innerHTML = `
                <div class="auth-box">
                    <div class="profile-header">
                        <img src="${u.photo || 'https://via.placeholder.com/150'}" alt="Foto" class="profile-img">
                        <h2>${u.name}</h2>
                        <p style="color:#666;">@${u.username}</p>
                        <span class="role-badge">${u.role}</span>
                        <p style="margin-top:10px; font-style:italic;">"${u.bio || 'Sem biografia.'}"</p>
                    </div>

                    <div style="text-align:center; margin-bottom:20px;">
                        <button class="btn btn-danger" onclick="logout()">Sair</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('editProfileForm').classList.toggle('hidden')">Editar Perfil</button>
                    </div>

                    <form id="editProfileForm" class="hidden" onsubmit="updateProfile(event)">
                        <div class="form-group">
                            <label>Nome</label>
                            <input type="text" name="name" value="${u.name}" required>
                        </div>
                        <div class="form-group">
                            <label>Foto URL</label>
                            <input type="text" name="photo" value="${u.photo || ''}">
                        </div>
                        <div class="form-group">
                            <label>Biografia</label>
                            <textarea name="bio">${u.bio || ''}</textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
                    </form>
                </div>

                ${journalistSection}
                ${adminSection}
            `;
        }

        function renderLogin() {
            main.innerHTML = `
                <div class="auth-box">
                    <h2 style="text-align:center; margin-bottom:20px; color:var(--cor-primaria);">Entrar no g1 Brookasil</h2>
                    <form onsubmit="handleLogin(event)">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label>Senha</label>
                            <input type="password" name="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width:100%;">Entrar</button>
                        <p style="margin-top:15px; text-align:center;">N√£o tem conta? <a href="#" onclick="router.go('register')" style="color:var(--cor-primaria); font-weight:bold;">Cadastre-se</a></p>
                    </form>
                </div>
            `;
        }

        function renderRegister() {
            main.innerHTML = `
                <div class="auth-box">
                    <h2 style="text-align:center; margin-bottom:20px; color:var(--cor-secundaria);">Criar Conta</h2>
                    <form onsubmit="handleRegister(event)">
                        <div class="form-group">
                            <label>Nome Completo</label>
                            <input type="text" name="name" required>
                        </div>
                        <div class="form-group">
                            <label>Usu√°rio (@)</label>
                            <input type="text" name="username" required>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label>Senha</label>
                            <input type="password" name="password" required>
                        </div>
                        <div class="form-group">
                            <label>C√≥digo Especial (Opcional - Para Staff)</label>
                            <input type="text" name="secretCode" placeholder="C√≥digo de convite">
                        </div>
                        <button type="submit" class="btn btn-secondary" style="width:100%;">Criar Conta</button>
                        <p style="margin-top:15px; text-align:center;">J√° tem conta? <a href="#" onclick="router.go('login')" style="color:var(--cor-primaria); font-weight:bold;">Entrar</a></p>
                    </form>
                </div>
            `;
        }

        function renderEditor(newsId) {
            if (!state.currentUser || (state.currentUser.role === 'usuario')) {
                alert('Acesso negado.');
                router.go('home');
                return;
            }

            const isEdit = !!newsId;
            let newsItem = {};
            if (isEdit) {
                newsItem = state.news.find(n => n.id === newsId);
            }

            main.innerHTML = `
                <div class="panel-box" style="max-width:800px;">
                    <h2>${isEdit ? 'Editar Not√≠cia' : 'Nova Not√≠cia'}</h2>
                    <form onsubmit="saveNewsForm(event, '${newsId || ''}')">
                        <div class="form-group">
                            <label>T√≠tulo</label>
                            <input type="text" name="title" value="${newsItem.title || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>Subt√≠tulo</label>
                            <input type="text" name="subtitle" value="${newsItem.subtitle || ''}" required>
                        </div>
                        <div class="grid" style="grid-template-columns: 1fr 1fr; gap:20px;">
                            <div class="form-group">
                                <label>Tema</label>
                                <select name="theme">
                                    <option value="Pol√≠tica" ${newsItem.theme === 'Pol√≠tica' ? 'selected' : ''}>Pol√≠tica</option>
                                    <option value="Pol√≠cia" ${newsItem.theme === 'Pol√≠cia' ? 'selected' : ''}>Pol√≠cia</option>
                                    <option value="Educa√ß√£o" ${newsItem.theme === 'Educa√ß√£o' ? 'selected' : ''}>Educa√ß√£o</option>
                                    <option value="Esporte" ${newsItem.theme === 'Esporte' ? 'selected' : ''}>Esporte</option>
                                    <option value="Entretenimento" ${newsItem.theme === 'Entretenimento' ? 'selected' : ''}>Entretenimento</option>
                                    <option value="Curiosidades" ${newsItem.theme === 'Curiosidades' ? 'selected' : ''}>Curiosidades</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>URL da Imagem</label>
                                <input type="text" name="image" value="${newsItem.image || ''}" placeholder="http://...">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Conte√∫do</label>
                            <textarea name="content" style="height:300px;" required>${newsItem.content || ''}</textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Publicar Not√≠cia</button>
                        <button type="button" class="btn btn-danger" onclick="router.go('perfil')">Cancelar</button>
                    </form>
                </div>
            `;
        }

        function renderDivulgacao() {
            if (!state.currentUser) {
                main.innerHTML = `
                    <div class="auth-box" style="text-align:center;">
                        <h2>üîí Acesso Restrito</h2>
                        <p>Para solicitar divulga√ß√µes de trabalho, voc√™ precisa estar logado.</p>
                        <button class="btn btn-primary" onclick="router.go('login')" style="margin-top:20px;">Fazer Login</button>
                    </div>
                `;
                return;
            }

            main.innerHTML = `
                <div class="panel-box">
                    <h2 style="color:var(--cor-secundaria);">üì¢ Divulga√ß√£o de Trabalho</h2>
                    <p style="margin-bottom:20px; font-size:0.9rem; color:#666;">Seu pedido passar√° por an√°lise da administra√ß√£o antes de ser publicado.</p>
                    
                    <form onsubmit="submitAd(event)">
                        <div class="form-group">
                            <label>T√≠tulo do Trabalho / Vaga</label>
                            <input type="text" name="title" required>
                        </div>
                        <div class="form-group">
                            <label>Categoria</label>
                            <select name="category">
                                <option>Vaga de Emprego</option>
                                <option>Servi√ßo Aut√¥nomo</option>
                                <option>Evento</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Descri√ß√£o Detalhada</label>
                            <textarea name="description" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Enviar para An√°lise</button>
                    </form>
                </div>

                <div class="container">
                    <h3 class="section-title" style="margin-top:40px;">Mural de Oportunidades</h3>
                    <div class="news-grid grid">
                        ${state.ads.filter(a => a.status === 'aprovado').map(a => `
                            <div class="news-card" style="padding:20px;">
                                <div class="news-theme">${a.category}</div>
                                <h3 class="news-title">${a.title}</h3>
                                <p style="font-size:0.9rem;">${a.description}</p>
                                <div style="margin-top:15px; font-size:0.8rem; color:#777;">Autor: ${a.authorName}</div>
                            </div>
                        `).join('')}
                    </div>
                    ${state.ads.filter(a => a.status === 'aprovado').length === 0 ? '<p>Nenhuma divulga√ß√£o no momento.</p>' : ''}
                </div>
            `;
        }

        /**
         * L√ìGICA DE FORMUL√ÅRIOS
         */
        
        async function handleLogin(e) {
            e.preventDefault();
            const email = e.target.email.value;
            const password = e.target.password.value;
            
            // Busca usu√°rio (em app real usaria Auth, aqui varremos users.json)
            const userId = email.replace(/[.]/g, '_');
            const user = state.users[userId];

            if (user && user.password === password) {
                state.currentUser = user;
                localStorage.setItem('g1_user', JSON.stringify(user));
                router.go('perfil');
            } else {
                alert('Email ou senha incorretos.');
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const form = e.target;
            
            let role = 'usuario';
            // Backdoor simples para testes (Senha mestre)
            if (form.secretCode.value === 'Brookasil1234') role = 'dono';
            if (form.secretCode.value === 'G1_Brookasil') role = 'jornalista';

            const user = {
                name: form.name.value,
                username: form.username.value,
                email: form.email.value,
                password: form.password.value,
                role: role,
                bio: 'Novo em Brookasil',
                photo: ''
            };

            const success = await DataManager.registerUser(user);
            if (success) {
                alert('Conta criada com sucesso! Fa√ßa login.');
                router.go('login');
            } else {
                alert('Usu√°rio j√° existe.');
            }
        }

        function logout() {
            state.currentUser = null;
            localStorage.removeItem('g1_user');
            router.go('home');
        }

        async function updateProfile(e) {
            e.preventDefault();
            const u = state.currentUser;
            u.name = e.target.name.value;
            u.photo = e.target.photo.value;
            u.bio = e.target.bio.value;
            
            await DataManager.updateUser(u);
            alert('Perfil atualizado!');
            renderProfile();
        }

        async function saveNewsForm(e, id) {
            e.preventDefault();
            const form = e.target;
            
            const newsItem = {
                id: id || null,
                title: form.title.value,
                subtitle: form.subtitle.value,
                theme: form.theme.value,
                image: form.image.value || 'https://via.placeholder.com/800x400?text=Sem+Imagem',
                content: form.content.value,
                author: state.currentUser.name,
                date: new Date().toISOString(),
                views: id ? state.news.find(n => n.id === id).views : 0
            };

            await DataManager.saveNews(newsItem);
            alert('Not√≠cia salva com sucesso!');
            router.go('home');
        }

        async function deleteNews(id) {
            if(confirm('Tem certeza que deseja apagar esta not√≠cia?')) {
                await DataManager.deleteNews(id);
                renderProfile();
            }
        }

        async function submitAd(e) {
            e.preventDefault();
            const form = e.target;
            const ad = {
                title: form.title.value,
                category: form.category.value,
                description: form.description.value,
                authorName: state.currentUser.name,
                authorId: state.currentUser.id
            };
            await DataManager.createAd(ad);
            alert('Divulga√ß√£o enviada para an√°lise!');
            form.reset();
        }

        async function approveAd(id, status) {
            await DataManager.updateAdStatus(id, status);
            renderProfile(); // Reload panel
        }

        async function promoteUser() {
            const email = document.getElementById('promoteEmail').value;
            const userId = email.replace(/[.]/g, '_');
            const user = state.users[userId];
            
            if (user) {
                user.role = 'jornalista';
                await DataManager.updateUser(user);
                alert(`${user.name} agora √© jornalista.`);
            } else {
                alert('Usu√°rio n√£o encontrado.');
            }
        }

        // Search Bar Logic
        document.getElementById('searchInput').addEventListener('keyup', (e) => {
            if(e.key === 'Enter') {
                renderNewsFeed('home', e.target.value);
            }
        });

        /**
         * INICIALIZA√á√ÉO
         */
        (async function init() {
            // Carrega dados do Firebase
            await DataManager.init();
            // Carrega Widget de Clima
            WeatherManager.init();
            // Inicia na Home
            router.go('home');
            
            // Atualiza hora a cada minuto
            setInterval(WeatherManager.init, 60000);
        })();

    </script>
</body>
</html>
