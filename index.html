<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>g1 Brookasil - O portal de not√≠cias de Brookasil</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --g1-red: #C4170C;
            --g1-dark: #111111;
            --g1-grey: #f6f6f6;
            --g1-text: #333;
            --g1-sub: #666;
            --g1-border: #e5e5e5;
            --ny-gold: #D4AF37;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        /* --- RESET & BASE --- */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        body { font-family: 'Open Sans', sans-serif; background: #fff; color: var(--g1-text); overflow-x: hidden; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .hidden { display: none !important; }
        button, .btn { cursor: pointer; border: none; transition: var(--transition); border-radius: 4px; font-weight: 700; }

        /* --- SPLASH SCREEN --- */
        #splash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--g1-red); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .splash-logo { font-size: 90px; font-weight: 900; color: #fff; letter-spacing: -6px; margin-bottom: 20px; }
        .loader-bg { width: 220px; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; overflow: hidden; }
        #loader-bar { width: 0%; height: 100%; background: #fff; transition: width 0.3s; }
        .loader-text { color: #fff; margin-top: 15px; font-size: 11px; text-transform: uppercase; font-weight: 700; letter-spacing: 1px; }

        /* --- HEADER & NAVIGATION --- */
        header { background: var(--g1-red); height: 64px; position: sticky; top: 0; z-index: 1000; box-shadow: var(--shadow); }
        .header-wrap { display: flex; align-items: center; height: 100%; justify-content: space-between; }
        
        .menu-btn { color: #fff; font-size: 28px; display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .logo { font-size: 32px; font-weight: 900; color: #fff; letter-spacing: -2px; cursor: pointer; }
        .logo span { font-weight: 300; font-size: 18px; opacity: 0.8; padding-left: 5px; border-left: 1px solid rgba(255,255,255,0.3); margin-left: 8px; }

        .header-meta { display: flex; align-items: center; gap: 20px; color: #fff; font-size: 12px; font-weight: 700; }
        #live-clock { background: rgba(0,0,0,0.2); padding: 4px 10px; border-radius: 4px; }

        /* --- SIDE MENU --- */
        #side-menu { 
            position: fixed; top: 0; left: -320px; width: 320px; height: 100%; background: #fff; 
            z-index: 1001; transition: var(--transition); padding: 40px 0; box-shadow: 15px 0 50px rgba(0,0,0,0.1);
        }
        #side-menu.open { left: 0; }
        .menu-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; display: none; backdrop-filter: blur(3px); }
        .nav-list { list-style: none; padding: 20px; }
        .nav-list li { margin-bottom: 2px; }
        .nav-list a { display: block; padding: 12px 15px; color: var(--g1-red); text-transform: uppercase; font-weight: 800; font-size: 14px; text-decoration: none; border-radius: 4px; }
        .nav-list a:hover { background: var(--g1-grey); }
        .nav-list .admin-link { color: #000; border-top: 1px solid var(--g1-border); margin-top: 15px; padding-top: 20px; }

        /* --- NEWS LAYOUT --- */
        .home-grid { margin: 30px 0; display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
        .hero-card { cursor: pointer; border-bottom: 1px solid var(--g1-border); padding-bottom: 25px; }
        .hero-card img { width: 100%; height: 480px; object-fit: cover; border-radius: 8px; margin-bottom: 20px; }
        .hero-card h1 { font-size: 44px; line-height: 1; color: var(--g1-red); margin-bottom: 15px; letter-spacing: -1.5px; }
        .hero-card p { font-size: 18px; color: var(--g1-sub); }

        .secondary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; margin-bottom: 50px; }
        .card { cursor: pointer; border-bottom: 1px solid var(--g1-border); padding-bottom: 15px; }
        .card:hover { opacity: 0.8; }
        .card img { width: 100%; height: 200px; object-fit: cover; border-radius: 4px; margin-bottom: 10px; }
        .card .label { color: var(--g1-red); font-size: 11px; font-weight: 800; text-transform: uppercase; margin-bottom: 5px; display: block; }
        .card h3 { font-size: 18px; line-height: 1.3; color: var(--g1-red); }

        /* --- ADMIN PANELS --- */
        .panel { background: var(--g1-grey); border-radius: 12px; padding: 40px; margin: 40px 0; border: 1px solid var(--g1-border); }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-size: 12px; font-weight: 800; text-transform: uppercase; margin-bottom: 8px; color: var(--g1-sub); }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 15px; border: 1px solid var(--g1-border); border-radius: 6px; font-family: inherit; font-size: 16px; }
        .btn-red { background: var(--g1-red); color: #fff; padding: 15px 30px; font-size: 14px; text-transform: uppercase; }
        .btn-red:hover { background: #9B120A; }
        
        .badge { padding: 4px 10px; border-radius: 4px; font-size: 10px; font-weight: 800; text-transform: uppercase; color: #fff; }
        .b-dono { background: #000; }
        .b-jor { background: var(--g1-red); }
        .b-user { background: #999; }

        /* --- ARTICLE VIEW --- */
        .article-page { max-width: 800px; margin: 60px auto; }
        .article-page h1 { font-size: 52px; line-height: 1.1; margin-bottom: 20px; }
        .article-meta { border-top: 1px solid var(--g1-border); padding: 20px 0; margin-bottom: 40px; font-size: 13px; color: var(--g1-sub); }
        .article-body { font-size: 20px; line-height: 1.8; color: #222; }
        .article-body img { width: 100%; border-radius: 8px; margin: 30px 0; }

        /* --- FOOTER --- */
        footer { background: var(--g1-grey); padding: 80px 0; border-top: 1px solid var(--g1-border); margin-top: 100px; }
        .footer-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 40px; }
        .footer-logo { font-size: 40px; font-weight: 900; color: var(--g1-red); margin-bottom: 20px; }

        /* --- RESPONSIVIDADE --- */
        @media (max-width: 992px) {
            .home-grid { grid-template-columns: 1fr; }
            .secondary-grid { grid-template-columns: 1fr 1fr; }
            .hero-card h1 { font-size: 32px; }
        }
    </style>
</head>
<body>

    <div id="splash">
        <div class="splash-logo">g1</div>
        <div class="loader-bg">
            <div id="loader-bar"></div>
        </div>
        <p class="loader-text">Carregando not√≠cias de Brookasil...</p>
    </div>

    <div class="menu-overlay" id="overlay" onclick="toggleMenu()"></div>
    <div id="side-menu">
        <ul class="nav-list" id="nav-links">
            </ul>
    </div>

    <header>
        <div class="container header-wrap">
            <div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>
            <div class="logo" onclick="app.navigate('home')">g1 <span>brookasil</span></div>
            <div class="header-meta">
                <span id="weather">24¬∞C Brookasil</span>
                <span id="live-clock">00:00:00</span>
            </div>
        </div>
    </header>

    <main id="app-root" class="container"></main>

    <footer>
        <div class="container">
            <div class="footer-grid">
                <div>
                    <div class="footer-logo">g1</div>
                    <p>O portal de not√≠cias de Brookasil. Informa√ß√£o com credibilidade.</p>
                </div>
                <div>
                    <h4 style="margin-bottom:20px">EDITORIAS</h4>
                    <p>Pol√≠tica ‚Ä¢ Esporte ‚Ä¢ Educa√ß√£o ‚Ä¢ Pol√≠cia</p>
                </div>
                <div>
                    <h4 style="margin-bottom:20px">SERVI√áOS</h4>
                    <p>Filia√ß√£o Partid√°ria ‚Ä¢ Candidatura CDE</p>
                </div>
                <div>
                    <h4 style="margin-bottom:20px">AJUDA</h4>
                    <p onclick="app.navigate('ajuda')" style="cursor:pointer">Central de Atendimento</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        /* --- CONFIG & STATE --- */
        const DB_URL = "https://g1-brookasil-default-rtdb.firebaseio.com";
        const state = {
            user: JSON.parse(localStorage.getItem('g1_session')) || null,
            news: [],
            users: []
        };

        /* --- CORE ENGINE --- */
        const app = {
            async init() {
                this.updateClock();
                setInterval(() => this.updateClock(), 1000);
                
                // Splash Logic
                const bar = document.getElementById('loader-bar');
                let p = 0;
                const int = setInterval(() => {
                    p += Math.random() * 25;
                    bar.style.width = Math.min(p, 100) + '%';
                    if(p >= 100) {
                        clearInterval(int);
                        this.loadData().then(() => {
                            document.getElementById('splash').style.opacity = '0';
                            setTimeout(() => {
                                document.getElementById('splash').style.display = 'none';
                                this.navigate('home');
                            }, 600);
                        });
                    }
                }, 150);
            },

            async loadData() {
                try {
                    const [nRes, uRes] = await Promise.all([
                        fetch(`${DB_URL}/news.json`).then(r => r.json()),
                        fetch(`${DB_URL}/users.json`).then(r => r.json())
                    ]);
                    state.news = nRes ? Object.values(nRes).reverse() : [];
                    state.users = uRes || {};
                } catch(e) { console.error("Erro ao carregar banco."); }
            },

            navigate(view, params = null) {
                toggleMenu(false);
                window.scrollTo(0,0);
                const root = document.getElementById('app-root');
                root.style.opacity = '0';
                
                setTimeout(() => {
                    this.render(view, root, params);
                    root.style.opacity = '1';
                    this.renderMenu();
                }, 200);
            },

            render(view, root, params) {
                switch(view) {
                    case 'home': renderHome(root); break;
                    case 'article': renderArticle(root, params); break;
                    case 'login': renderLogin(root); break;
                    case 'painel-dono': renderDono(root); break;
                    case 'painel-jor': renderJornalista(root); break;
                    case 'ajuda': renderAjuda(root); break;
                    case 'filiacao': renderExternal(root, 'Filia√ß√£o Partid√°ria', 'https://tsedoroblox2025.github.io/filia-o.html/'); break;
                    case 'candidatura': renderExternal(root, 'Candidatura CDE', 'https://tsedoroblox2025.github.io/candidatura-cde/'); break;
                }
            },

            updateClock() {
                const now = new Date();
                document.getElementById('live-clock').innerText = now.toLocaleTimeString('pt-BR', {timeZone: 'America/Maceio'});
            },

            renderMenu() {
                const list = document.getElementById('nav-links');
                let html = `
                    <li><a href="#" onclick="app.navigate('home')">Home</a></li>
                    <li><a href="#" onclick="app.navigate('ajuda')">Ajuda</a></li>
                    <li><a href="#" onclick="app.navigate('filiacao')">Filia√ß√£o Partid√°ria</a></li>
                    <li><a href="#" onclick="app.navigate('candidatura')">Candidatura (CDE)</a></li>
                `;

                if(state.user) {
                    if(state.user.role === 'dono') html += `<li><a href="#" onclick="app.navigate('painel-dono')" class="admin-link">üëë Painel do Dono</a></li>`;
                    if(state.user.role === 'jornalista') html += `<li><a href="#" onclick="app.navigate('painel-jor')" class="admin-link">üì∞ Painel Jornalista</a></li>`;
                    html += `<li><a href="#" onclick="app.logout()" style="color:#666">Sair (@${state.user.user})</a></li>`;
                } else {
                    html += `<li><a href="#" onclick="app.navigate('login')" class="admin-link">Minha Conta</a></li>`;
                }
                list.innerHTML = html;
            },

            logout() {
                localStorage.removeItem('g1_session');
                state.user = null;
                this.navigate('home');
            }
        };

        /* --- VIEWS --- */
        function renderHome(el) {
            const top = state.news[0] || { titulo: "Bem-vindo", subtitulo: "Carregando...", imagem: "" };
            const sub = state.news.slice(1, 7);

            el.innerHTML = `
                <section class="home-grid">
                    <div class="hero-card" onclick="app.navigate('article', '${top.id}')">
                        <img src="${top.imagem}">
                        <h1>${top.titulo}</h1>
                        <p>${top.subtitulo}</p>
                    </div>
                    <div class="trending">
                        <h3 style="border-bottom:3px solid var(--g1-red); display:inline-block; margin-bottom:20px;">MAIS LIDAS</h3>
                        ${state.news.slice(0, 5).map((n, i) => `
                            <div style="margin-bottom:15px; cursor:pointer;" onclick="app.navigate('article', '${n.id}')">
                                <span style="font-size:32px; font-weight:900; color:var(--g1-border); float:left; margin-right:15px">${i+1}</span>
                                <p style="font-weight:700; font-size:14px; color:var(--g1-red)">${n.titulo}</p>
                            </div>
                        `).join('')}
                    </div>
                </section>
                <div class="secondary-grid">
                    ${sub.map(n => `
                        <div class="card" onclick="app.navigate('article', '${n.id}')">
                            <img src="${n.imagem}">
                            <span class="label">${n.tema}</span>
                            <h3>${n.titulo}</h3>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderArticle(el, id) {
            const n = state.news.find(x => x.id == id);
            if(!n) return;
            el.innerHTML = `
                <div class="article-page">
                    <span class="badge b-jor">${n.tema}</span>
                    <h1 style="margin-top:15px">${n.titulo}</h1>
                    <h2 style="font-size:24px; color:var(--g1-sub); font-weight:400; margin-bottom:30px">${n.subtitulo}</h2>
                    <div class="article-meta">
                        Por <strong>${n.autor}</strong>, g1 Brookasil ‚Äî Alagoas<br>
                        ${new Date(n.data).toLocaleString('pt-BR')}
                    </div>
                    <div class="article-body">
                        <img src="${n.imagem}">
                        <p>${n.conteudo}</p>
                    </div>
                </div>
            `;
        }

        function renderLogin(el) {
            el.innerHTML = `
                <div class="panel" style="max-width:500px; margin: 60px auto;">
                    <h2 style="text-align:center; margin-bottom:30px;">Acessar g1 Brookasil</h2>
                    <div class="form-group">
                        <label>@usu√°rio</label>
                        <input type="text" id="l-user">
                    </div>
                    <div class="form-group">
                        <label>Senha</label>
                        <input type="password" id="l-pass">
                    </div>
                    <button class="btn btn-red" style="width:100%" onclick="auth.handle()">Entrar / Cadastrar</button>
                    <p style="font-size:11px; color:#999; margin-top:15px; text-align:center">Dica: Se voc√™ for o Dono, use a senha mestre no cadastro.</p>
                </div>
            `;
        }

        function renderDono(el) {
            if(state.user?.role !== 'dono') return app.navigate('home');
            const uList = Object.entries(state.users);
            el.innerHTML = `
                <div class="panel">
                    <h1>üëë Painel de Controle (Dono)</h1>
                    <table style="width:100%; border-collapse:collapse; margin-top:30px; background:#fff;">
                        <thead><tr style="background:#eee; text-align:left;">
                            <th style="padding:15px">Usu√°rio</th><th style="padding:15px">Cargo</th><th style="padding:15px">A√ß√£o</th>
                        </tr></thead>
                        <tbody>
                            ${uList.map(([id, u]) => `
                                <tr style="border-bottom:1px solid #ddd">
                                    <td style="padding:15px">@${u.user}</td>
                                    <td style="padding:15px"><span class="badge ${u.role === 'dono' ? 'b-dono' : u.role === 'jornalista' ? 'b-jor' : 'b-user'}">${u.role}</span></td>
                                    <td style="padding:15px">
                                        <button onclick="auth.updateRole('${id}', 'jornalista')" style="font-size:10px; color:blue">Virar Jornalista</button> | 
                                        <button onclick="auth.updateRole('${id}', 'usuario')" style="font-size:10px; color:red">Rebaixar</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function renderJornalista(el) {
            if(state.user?.role !== 'jornalista' && state.user?.role !== 'dono') return app.navigate('home');
            el.innerHTML = `
                <div class="panel">
                    <h2>üì∞ Central do Jornalista</h2>
                    <div class="form-group"><label>T√≠tulo</label><input type="text" id="n-titulo"></div>
                    <div class="form-group"><label>Subt√≠tulo</label><input type="text" id="n-sub"></div>
                    <div class="form-group"><label>Tema</label><select id="n-tema">
                        <option>POL√çTICA</option><option>ESPORTE</option><option>EDUCA√á√ÉO</option><option>POL√çCIA</option>
                    </select></div>
                    <div class="form-group"><label>URL Imagem</label><input type="text" id="n-img"></div>
                    <div class="form-group"><label>Conte√∫do</label><textarea id="n-content" style="height:200px"></textarea></div>
                    <button class="btn btn-red" onclick="news.publish()">Publicar Mat√©ria</button>
                </div>
            `;
        }

        function renderAjuda(el) {
            el.innerHTML = `
                <div class="article-page">
                    <h1>Central de Ajuda</h1>
                    <div class="article-body">
                        <p><strong>Como criar conta?</strong> Basta ir em "Minha Conta", digitar um @usu√°rio e uma senha. Se o usu√°rio n√£o existir, ele ser√° criado automaticamente.</p>
                        <p><strong>Como postar not√≠cias?</strong> Apenas usu√°rios promovidos a "Jornalista" pelo Dono podem postar.</p>
                    </div>
                </div>
            `;
        }

        function renderExternal(el, title, url) {
            el.innerHTML = `
                <div class="panel" style="text-align:center">
                    <h1>${title}</h1>
                    <p style="margin:20px 0">Voc√™ est√° sendo redirecionado para o sistema externo de Brookasil.</p>
                    <a href="${url}" target="_blank" class="btn btn-red" style="text-decoration:none; display:inline-block">Acessar Portal Externo</a>
                </div>
            `;
        }

        /* --- LOGIC HELPERS --- */
        const auth = {
            async handle() {
                const u = document.getElementById('l-user').value.replace('@', '');
                const p = document.getElementById('l-pass').value;
                if(!u || !p) return alert("Preencha tudo.");

                const role = (p === 'Brookasil1234') ? 'dono' : 'usuario';
                const userData = { user: u, pass: p, role: role, nome: u };

                // Simula√ß√£o de Registro/Login Autom√°tico
                await fetch(`${DB_URL}/users/${u}.json`, { method: 'PUT', body: JSON.stringify(userData) });
                state.user = userData;
                localStorage.setItem('g1_session', JSON.stringify(userData));
                app.navigate('home');
            },
            async updateRole(id, role) {
                await fetch(`${DB_URL}/users/${id}/role.json`, { method: 'PUT', body: JSON.stringify(role) });
                app.loadData().then(() => app.navigate('painel-dono'));
            }
        };

        const news = {
            async publish() {
                const data = {
                    id: Date.now(),
                    titulo: document.getElementById('n-titulo').value,
                    subtitulo: document.getElementById('n-sub').value,
                    tema: document.getElementById('n-tema').value,
                    imagem: document.getElementById('n-img').value,
                    conteudo: document.getElementById('n-content').value,
                    autor: state.user.nome,
                    data: new Date().toISOString()
                };
                await fetch(`${DB_URL}/news/${data.id}.json`, { method: 'PUT', body: JSON.stringify(data) });
                alert("Publicado!");
                app.loadData().then(() => app.navigate('home'));
            }
        };

        function toggleMenu(force) {
            const m = document.getElementById('side-menu');
            const o = document.getElementById('overlay');
            const isOpen = force !== undefined ? force : !m.classList.contains('open');
            m.classList.toggle('open', isOpen);
            o.style.display = isOpen ? 'block' : 'none';
        }

        // Initialize App
        app.init();

    </script>
</body>
</html>
