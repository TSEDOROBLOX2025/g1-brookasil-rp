<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>g1 Brookasil - O portal de not√≠cias de Brookasil</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- DESIGN SYSTEM G1 ENTERPRISE --- */
        :root {
            --g1-red: #C4170C;
            --g1-dark-red: #9B120A;
            --g1-bg: #FFFFFF;
            --g1-text: #333333;
            --g1-sub: #666666;
            --g1-border: #E5E5E5;
            --g1-grey: #F6F6F6;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        body { font-family: 'Open Sans', sans-serif; background: var(--g1-bg); color: var(--g1-text); overflow-x: hidden; }

        /* --- SPLASH SCREEN --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--g1-red); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.8s ease;
        }
        .splash-logo { font-size: 80px; font-weight: 900; color: white; letter-spacing: -6px; margin-bottom: 20px; animation: zoomIn 1.5s ease; }
        .loading-bar-container { width: 200px; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; overflow: hidden; }
        .loading-bar { width: 0%; height: 100%; background: white; transition: width 0.4s; }
        .loading-text { color: white; margin-top: 15px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }

        @keyframes zoomIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* --- HEADER & NAVIGATION --- */
        header { 
            background: var(--g1-red); padding: 12px 0; position: sticky; top: 0; z-index: 1000;
            box-shadow: var(--shadow); display: flex; align-items: center;
        }
        .header-container { display: flex; align-items: center; width: 100%; max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        
        /* Menu Hamburger */
        .menu-trigger { cursor: pointer; display: flex; flex-direction: column; gap: 5px; margin-right: 25px; padding: 10px; z-index: 1001; }
        .menu-trigger span { width: 25px; height: 3px; background: white; border-radius: 2px; transition: var(--transition); }
        .menu-trigger.active span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
        .menu-trigger.active span:nth-child(2) { opacity: 0; }
        .menu-trigger.active span:nth-child(3) { transform: rotate(-45deg) translate(6px, -7px); }

        .logo { font-size: 34px; font-weight: 900; color: white; letter-spacing: -2px; cursor: pointer; }
        .logo span { font-weight: 300; font-size: 22px; margin-left: 5px; opacity: 0.8; }

        .header-info { margin-left: auto; display: flex; align-items: center; gap: 20px; color: white; font-size: 11px; font-weight: 700; }
        #live-clock { color: #fff; background: rgba(0,0,0,0.2); padding: 4px 8px; border-radius: 4px; }

        /* --- SIDE MENU OVERLAY --- */
        #side-menu {
            position: fixed; top: 0; left: -320px; width: 320px; height: 100%;
            background: white; z-index: 1000; transition: left 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
            box-shadow: 10px 0 30px rgba(0,0,0,0.1); padding: 80px 30px;
        }
        #side-menu.open { left: 0; }
        .menu-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; display: none; }
        .side-nav-links { list-style: none; }
        .side-nav-links li { margin-bottom: 15px; border-bottom: 1px solid var(--g1-border); }
        .side-nav-links a { display: block; padding: 10px 0; color: var(--g1-red); font-weight: 800; font-size: 16px; text-transform: uppercase; }

        /* --- HOME LAYOUT --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .main-manchete { margin: 30px 0; cursor: pointer; position: relative; }
        .manchete-img { width: 100%; height: 500px; object-fit: cover; border-radius: 8px; box-shadow: var(--shadow); }
        .manchete-content { padding: 25px 0; border-bottom: 1px solid var(--g1-border); }
        .manchete-content h1 { font-size: 48px; color: var(--g1-red); line-height: 1.1; margin-bottom: 15px; letter-spacing: -2px; }
        .manchete-content p { font-size: 20px; color: var(--g1-sub); }

        .news-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; margin: 40px 0; }
        .card { cursor: pointer; border-bottom: 1px solid var(--g1-border); padding-bottom: 20px; transition: var(--transition); }
        .card:hover { opacity: 0.7; transform: translateY(-3px); }
        .card img { width: 100%; height: 180px; object-fit: cover; border-radius: 4px; margin-bottom: 12px; }
        .card .tema { color: var(--g1-red); font-weight: 800; font-size: 12px; text-transform: uppercase; }
        .card h3 { font-size: 20px; color: var(--g1-red); margin: 8px 0; line-height: 1.3; }

        /* --- FORMS & PANELS --- */
        .admin-box { background: var(--g1-grey); padding: 30px; border-radius: 12px; margin-top: 30px; border: 1px solid var(--g1-border); }
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 10px; font-weight: 800; text-transform: uppercase; color: white; }
        .badge-dono { background: #000; }
        .badge-jor { background: var(--g1-red); }
        .badge-user { background: #999; }

        .input-g1 { width: 100%; padding: 15px; border: 1px solid var(--g1-border); border-radius: 6px; margin-bottom: 15px; font-size: 16px; }
        .btn-g1 { background: var(--g1-red); color: white; border: none; padding: 15px 30px; border-radius: 6px; font-weight: 800; text-transform: uppercase; cursor: pointer; transition: var(--transition); }
        .btn-g1:hover { background: var(--g1-dark-red); }

        /* --- FOOTER --- */
        footer { background: var(--g1-grey); padding: 60px 0; border-top: 1px solid var(--g1-border); margin-top: 80px; }
        .footer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 40px; }
        .footer-col h4 { color: var(--g1-red); margin-bottom: 20px; text-transform: uppercase; }
        
        .hidden { display: none !important; }

        @media (max-width: 768px) {
            .manchete-content h1 { font-size: 32px; }
            .header-info { display: none; }
        }
    </style>
</head>
<body>

    <div id="splash-screen">
        <div class="splash-logo">g1</div>
        <div class="loading-bar-container">
            <div class="loading-bar" id="load-bar"></div>
        </div>
        <p class="loading-text">Carregando not√≠cias...</p>
    </div>

    <div class="menu-overlay" id="overlay" onclick="toggleMenu()"></div>
    <div id="side-menu">
        <ul class="side-nav-links">
            <li><a href="#" onclick="router.go('home')">Home</a></li>
            <li><a href="#" onclick="router.go('politica')">Pol√≠tica</a></li>
            <li><a href="#" onclick="router.go('filiacao')">Filia√ß√£o Partid√°ria</a></li>
            <li><a href="#" onclick="router.go('candidatura')">Candidatura (CDE)</a></li>
            <li><a href="#" onclick="router.go('divulgacao')">Divulga√ß√£o de Trabalho</a></li>
            <li><a href="#" onclick="router.go('ajuda')">Ajuda</a></li>
            <li id="menu-auth-btn"><a href="#" onclick="router.go('login')">Minha Conta</a></li>
            <li id="menu-panel-btn" class="hidden"><a href="#" onclick="router.go('painel')" style="color: #000;">Painel de Controle</a></li>
        </ul>
    </div>

    <header>
        <div class="header-container">
            <div class="menu-trigger" id="hamburger" onclick="toggleMenu()">
                <span></span><span></span><span></span>
            </div>
            <div class="logo" onclick="router.go('home')">g1 <span>Brookasil</span></div>
            <div class="header-info">
                <span id="clima">28¬∞C ENSOLARADO</span>
                <span id="live-clock">00:00:00</span>
            </div>
        </div>
    </header>

    <main id="app" class="container">
        </main>

    <footer>
        <div class="container footer-grid">
            <div class="footer-col">
                <h4>g1 Brookasil</h4>
                <p>O portal de not√≠cias da regi√£o de Brookasil. Informa√ß√£o com agilidade e isen√ß√£o.</p>
            </div>
            <div class="footer-col">
                <h4>Editorias</h4>
                <p>Pol√≠tica ‚Ä¢ Pol√≠cia ‚Ä¢ Esporte ‚Ä¢ Educa√ß√£o</p>
            </div>
            <div class="footer-col">
                <h4>Acesso</h4>
                <p onclick="router.go('login')" style="cursor:pointer">Login do Jornalista</p>
                <p onclick="router.go('ajuda')" style="cursor:pointer">Central de Ajuda</p>
            </div>
        </div>
        <div class="container" style="text-align:center; margin-top:40px; font-size:12px; opacity:0.6;">
            &copy; 2025 Brookasil Not√≠cias S.A. Todos os direitos reservados.
        </div>
    </footer>

    <script>
        /* --- CONFIGURA√á√ÉO FIREBASE / API --- */
        const DB_URL = "https://g1-brookasil-default-rtdb.firebaseio.com";
        
        // Estado Global
        const state = {
            user: JSON.parse(localStorage.getItem('g1_user')) || null,
            news: [],
            usersList: []
        };

        /* --- ENGINE DE ROTEAMENTO & VIEWS --- */
        const router = {
            async go(path, params = null) {
                const app = document.getElementById('app');
                app.innerHTML = '<div style="padding:100px; text-align:center;">Carregando...</div>';
                toggleMenu(false);
                window.scrollTo(0,0);

                switch(path) {
                    case 'home': await renderHome(app); break;
                    case 'login': renderLogin(app); break;
                    case 'news': await renderArticle(app, params); break;
                    case 'painel': renderPainel(app); break;
                    case 'ajuda': renderAjuda(app); break;
                    case 'filiacao': renderFiliacao(app); break;
                    case 'divulgacao': renderDivulgacao(app); break;
                    default: await renderHome(app);
                }
                this.updateUI();
            },
            updateUI() {
                const panelBtn = document.getElementById('menu-panel-btn');
                if(state.user && (state.user.role === 'dono' || state.user.role === 'jornalista')) {
                    panelBtn.classList.remove('hidden');
                } else {
                    panelBtn.classList.add('hidden');
                }
            }
        };

        /* --- VIEW: HOME --- */
        async function renderHome(el) {
            const data = await api.fetch('/news');
            state.news = data ? Object.values(data).reverse() : [];
            
            if(state.news.length === 0) {
                el.innerHTML = "<p style='padding:50px; text-align:center;'>Nenhuma not√≠cia publicada ainda.</p>";
                return;
            }

            const principal = state.news[0];
            const secundarias = state.news.slice(1, 7);

            el.innerHTML = `
                <section class="main-manchete" onclick="router.go('news', '${principal.id}')">
                    <img src="${principal.imagem}" class="manchete-img">
                    <div class="manchete-content">
                        <span class="badge badge-jor" style="margin-bottom:10px; display:inline-block;">Destaque</span>
                        <h1>${principal.titulo}</h1>
                        <p>${principal.subtitulo}</p>
                    </div>
                </section>
                <div class="news-grid">
                    ${secundarias.map(n => `
                        <div class="card" onclick="router.go('news', '${n.id}')">
                            <img src="${n.imagem}">
                            <span class="tema">${n.tema}</span>
                            <h3>${n.titulo}</h3>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        /* --- VIEW: LOGIN / CADASTRO --- */
        function renderLogin(el) {
            el.innerHTML = `
                <div class="admin-box" style="max-width: 500px; margin: 60px auto;">
                    <h2 style="text-align:center; margin-bottom:30px; color:var(--g1-red);">Acesse sua Conta g1</h2>
                    <input type="text" id="log-user" class="input-g1" placeholder="@usu√°rio">
                    <input type="password" id="log-pass" class="input-g1" placeholder="Senha">
                    <button class="btn-g1" style="width:100%;" onclick="auth.login()">Entrar</button>
                    <hr style="margin:20px 0; opacity:0.2;">
                    <p style="text-align:center; font-size:14px;">N√£o tem conta? <a href="#" onclick="renderCadastro()" style="color:var(--g1-red); font-weight:700;">Cadastre-se</a></p>
                </div>
            `;
        }

        /* --- VIEW: PAIN√âIS (DONO / JORNALISTA) --- */
        async function renderPainel(el) {
            if(!state.user) return router.go('login');
            
            if(state.user.role === 'dono') {
                const users = await api.fetch('/users');
                const list = users ? Object.entries(users) : [];
                
                el.innerHTML = `
                    <div class="admin-box fade-in">
                        <h1 style="color:var(--g1-red); margin-bottom:10px;">üëë Painel do Dono</h1>
                        <p style="margin-bottom:30px;">Gerenciamento de acessos e usu√°rios do g1 Brookasil.</p>
                        
                        <div style="overflow-x:auto;">
                            <table style="width:100%; border-collapse:collapse; background:white; border-radius:8px;">
                                <tr style="text-align:left; background:#eee;">
                                    <th style="padding:15px;">Usu√°rio</th>
                                    <th style="padding:15px;">Cargo</th>
                                    <th style="padding:15px; text-align:right;">A√ß√£o</th>
                                </tr>
                                ${list.map(([id, u]) => `
                                    <tr style="border-bottom:1px solid #eee;">
                                        <td style="padding:15px;"><strong>${u.nome}</strong><br><small>@${u.user}</small></td>
                                        <td style="padding:15px;"><span class="badge ${u.role === 'dono' ? 'badge-dono' : u.role === 'jornalista' ? 'badge-jor' : 'badge-user'}">${u.role}</span></td>
                                        <td style="padding:15px; text-align:right;">
                                            ${u.role !== 'dono' ? `
                                                <button onclick="admin.toggleJornalista('${id}', '${u.role}')" style="background:none; border:none; color:var(--g1-red); font-weight:700; cursor:pointer;">
                                                    ${u.role === 'jornalista' ? 'Rebaixar' : 'Promover'}
                                                </button>
                                            ` : '--'}
                                        </td>
                                    </tr>
                                `).join('')}
                            </table>
                        </div>
                    </div>
                `;
            } else if(state.user.role === 'jornalista') {
                const data = await api.fetch('/news');
                const myNews = data ? Object.values(data).filter(n => n.autorId === state.user.id) : [];

                el.innerHTML = `
                    <div class="admin-box">
                        <h1 style="color:var(--g1-red);">üì∞ Painel do Jornalista</h1>
                        <button class="btn-g1" style="margin:20px 0;" onclick="renderEditor()">+ Nova Not√≠cia</button>
                        
                        <div class="news-grid">
                            ${myNews.map(n => `
                                <div class="card" style="background:white; padding:15px; border-radius:8px;">
                                    <h4>${n.titulo}</h4>
                                    <div style="margin-top:10px; display:flex; gap:10px;">
                                        <button onclick="router.go('news', '${n.id}')" style="font-size:11px;">Ver</button>
                                        <button onclick="admin.deleteNews('${n.id}')" style="font-size:11px; color:red;">Excluir</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
        }

        function renderEditor() {
            const el = document.getElementById('app');
            el.innerHTML = `
                <div class="admin-box">
                    <h2>Nova Not√≠cia</h2>
                    <input type="text" id="n-titulo" class="input-g1" placeholder="T√≠tulo da Manchete">
                    <input type="text" id="n-sub" class="input-g1" placeholder="Subt√≠tulo">
                    <input type="text" id="n-img" class="input-g1" placeholder="URL da Imagem">
                    <select id="n-tema" class="input-g1">
                        <option value="POL√çTICA">Pol√≠tica</option>
                        <option value="POL√çCIA">Pol√≠cia</option>
                        <option value="ESPORTE">Esporte</option>
                        <option value="ENTRETENIMENTO">Entretenimento</option>
                    </select>
                    <textarea id="n-content" class="input-g1" style="height:300px;" placeholder="Conte√∫do da not√≠cia..."></textarea>
                    <button class="btn-g1" onclick="admin.saveNews()">Publicar Agora</button>
                </div>
            `;
        }

        /* --- VIEW: ARTIGO --- */
        async function renderArticle(el, id) {
            const n = state.news.find(x => x.id === id) || await api.fetch(`/news/${id}`);
            if(!n) return router.go('home');

            el.innerHTML = `
                <article style="max-width:800px; margin:40px auto;">
                    <span class="badge badge-jor">${n.tema}</span>
                    <h1 style="font-size:42px; margin:20px 0; line-height:1.1;">${n.titulo}</h1>
                    <p style="font-size:22px; color:var(--g1-sub); margin-bottom:30px;">${n.subtitulo}</p>
                    <div style="padding:15px 0; border-top:1px solid #eee; margin-bottom:30px; font-size:13px; color:#999;">
                        Por <strong>${n.autorNome}</strong>, g1 Brookasil ‚Äî Brookasil<br>
                        ${new Date(n.data).toLocaleString()}
                    </div>
                    <img src="${n.imagem}" style="width:100%; border-radius:8px; margin-bottom:30px;">
                    <div style="font-size:19px; line-height:1.8; color:#333;">${n.conteudo.replace(/\n/g, '<br><br>')}</div>
                </article>
            `;
        }

        /* --- L√ìGICA CORE --- */
        const api = {
            async fetch(path) {
                const r = await fetch(`${DB_URL}${path}.json`);
                return r.json();
            },
            async post(path, data) {
                return fetch(`${DB_URL}${path}.json`, { method: 'POST', body: JSON.stringify(data) });
            },
            async patch(path, data) {
                return fetch(`${DB_URL}${path}.json`, { method: 'PATCH', body: JSON.stringify(data) });
            },
            async delete(path) {
                return fetch(`${DB_URL}${path}.json`, { method: 'DELETE' });
            }
        };

        const auth = {
    // Cadastro: O usu√°rio escolhe o @, mas o cargo √© definido pela senha
    async cadastrar() {
        const nome = document.getElementById('reg-nome').value;
        const user = document.getElementById('reg-user').value.replace('@', '');
        const pass = document.getElementById('reg-pass').value;
        const foto = document.getElementById('reg-foto').value || 'https://i.pravatar.cc/150';

        if (!nome || !user || !pass) return alert("Preencha todos os campos obrigat√≥rios.");

        // Regra de Ouro: Se a senha for a secreta, ele j√° nasce como DONO
        const role = (pass === 'Brookasil1234') ? 'dono' : 'usuario';

        const novoUsuario = {
            nome,
            user: `@${user}`,
            pass,
            foto,
            role,
            dataCadastro: new Date().toISOString()
        };

        try {
            // Salva no Firebase usando o @usu√°rio como chave √∫nica
            await api.patch(`/users/${user}`, novoUsuario);
            alert(role === 'dono' ? "Bem-vindo, Dono! Acesso total liberado." : "Conta criada com sucesso!");
            this.saveSession({ id: user, ...novoUsuario });
        } catch (e) {
            alert("Erro ao criar conta. Tente outro @usu√°rio.");
        }
    },

    async login() {
        const userDigitado = document.getElementById('log-user').value.replace('@', '');
        const passDigitada = document.getElementById('log-pass').value;

        // Busca o usu√°rio direto pela chave no Firebase
        const u = await api.fetch(`/users/${userDigitado}`);

        if (u && u.pass === passDigitada) {
            this.saveSession({ id: userDigitado, ...u });
        } else {
            alert("Usu√°rio n√£o encontrado ou senha incorreta.");
        }
    },

    saveSession(data) {
        state.user = data;
        localStorage.setItem('g1_user', JSON.stringify(data));
        router.go('home');
    }
};

            saveSession(data) {
                state.user = data;
                localStorage.setItem('g1_user', JSON.stringify(data));
                router.go('home');
            }
        };

        const admin = {
            async toggleJornalista(id, currentRole) {
                const newRole = currentRole === 'jornalista' ? 'usuario' : 'jornalista';
                await api.patch(`/users/${id}`, { role: newRole });
                router.go('painel');
            },
            async saveNews() {
                const n = {
                    id: 'n' + Date.now(),
                    titulo: document.getElementById('n-titulo').value,
                    subtitulo: document.getElementById('n-sub').value,
                    imagem: document.getElementById('n-img').value,
                    tema: document.getElementById('n-tema').value,
                    conteudo: document.getElementById('n-content').value,
                    data: new Date().toISOString(),
                    autorNome: state.user.nome,
                    autorId: state.user.id
                };
                await api.patch(`/news/${n.id}`, n);
                router.go('home');
            },
            async deleteNews(id) {
                if(confirm("Deseja excluir esta not√≠cia?")) {
                    await api.delete(`/news/${id}`);
                    router.go('painel');
                }
            }
        };

        /* --- UTILIT√ÅRIOS UI --- */
        function toggleMenu(force) {
            const menu = document.getElementById('side-menu');
            const overlay = document.getElementById('overlay');
            const ham = document.getElementById('hamburger');
            const isOpen = typeof force === 'boolean' ? force : !menu.classList.contains('open');

            menu.classList.toggle('open', isOpen);
            overlay.style.display = isOpen ? 'block' : 'none';
            ham.classList.toggle('active', isOpen);
        }

        function updateClock() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('pt-BR', { timeZone: 'America/Maceio' });
            document.getElementById('live-clock').innerText = timeStr;
        }

        /* --- INITIALIZATION --- */
        window.onload = () => {
            const bar = document.getElementById('load-bar');
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += Math.random() * 30;
                bar.style.width = Math.min(progress, 100) + '%';
                
                if(progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('splash-screen').style.opacity = '0';
                        setTimeout(() => {
                            document.getElementById('splash-screen').style.display = 'none';
                            router.go('home');
                        }, 800);
                    }, 500);
                }
            }, 200);

            setInterval(updateClock, 1000);
            updateClock();
        };

    </script>
</body>
</html>
